//依赖jQuery  
let dataEvent = [{
	"itemName": "残疾人交通补贴申请",
	"itemCode": "312090152000",
	"itemCodeNew": "531200037400001"
}, {
	"itemName": "听力、言语残疾人信息卡套餐服务申请",
	"itemCode": "312090154000",
	"itemCodeNew": "531200106500001"
}, {
	"itemName": "兵役档案查询",
	"itemCode": "531200101600001",
	"itemCodeNew": "531200106500001"
}, {
	"itemName": "承包地确权登记档案",
	"itemCode": "531200101600001",
	"itemCodeNew": "531200147100001"
}, {
	"itemName": "独生子女证档案查询",
	"itemCode": "312090157000",
	"itemCodeNew": "531200021500001"
}, {
	"itemName": "工伤认定档案查询",
	"itemCode": "312090162000",
	"itemCodeNew": "531200106200001"
}, {
	"itemName": "婚姻登记档案查询",
	"itemCode": "312090156000",
	"itemCodeNew": "531200037000001"
}, {
	"itemName": "农民建房审批档案",
	"itemCode": "531200025500001",
	"itemCodeNew": ""
}, {
	"itemName": "人才引进审批档案查询",
	"itemCode": "312090167000",
	"itemCodeNew": "531200107700001"
}, {
	"itemName": "三峡移民档案查询",
	"itemCode": "312090166000",
	"itemCodeNew": "531200018100001"
}, {
	"itemName": "涉外婚姻登记档案查询",
	"itemCode": "312090187000",
	"itemCodeNew": "531200013600001"
}, {
	"itemName": "市级人才引进审批档案查询",
	"itemCode": "312090186000",
	"itemCodeNew": "531200025300001"
}, {
	"itemName": "上海市三八红旗手档案",
	"itemCode": "3120W1110000",
	"itemCodeNew": "531200024400001"
}, {
	"itemName": "复员退伍军人档案查询",
	"itemCode": "312090165000",
	"itemCodeNew": "531200105200001"
}, {
	"itemName": "学籍档案查询",
	"itemCode": "312090163000",
	"itemCodeNew": "531200105500001"
}, {
	"itemName": "再生育子女审批档案查询",
	"itemCode": "312090161000",
	"itemCodeNew": "531200024500001"
}, {
	"itemName": "知青返城档案查询",
	"itemCode": "312090159000",
	"itemCodeNew": "531200032100001"
}, {
	"itemName": "知青上山下乡档案查询",
	"itemCode": "312090158000",
	"itemCodeNew": "531200104600001"
}, {
	"itemName": "知青子女入户档案查询",
	"itemCode": "312090160000",
	"itemCodeNew": "531200104500001"
}, {
	"itemName": "专业技术干部的农村家属迁往城镇审批档案",
	"itemCode": "312090185000",
	"itemCodeNew": "531200020800001"
}, {
	"itemName": "信用报告查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "出境入境记录",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "非上海生源高校毕业生落户查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "户籍人户分离人员居住登记受理",
	"itemCode": "312090016000",
	"itemCodeNew": "531200008300001"
}, {
	"itemName": "户籍人户分离人员居住登记注销",
	"itemCode": "312090017000",
	"itemCodeNew": "531200008600001"
}, {
	"itemName": "机动车违法信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "敬老卡申领",
	"itemCode": "",
	"itemCodeNew": "531200043200001"
}, {
	"itemName": "居住证签注",
	"itemCode": "312090002000",
	"itemCodeNew": "531200019400001"
}, {
	"itemName": "开具有无违法犯罪记录证明",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "属地派出所查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "同日出生人数",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "新版社保卡开通服务",
	"itemCode": "312090174000",
	"itemCodeNew": "531200017600001"
}, {
	"itemName": "新生儿重名查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "户籍证明开具",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "交管信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "公交卡余额查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "驾照考点查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "民办教育机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "全市示范高中信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "上海市学生事务中心存档证明",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "计算机等级考试成绩查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "中外合作办学信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "幼升小报名信息查询(公办、民办)",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "小升初报名信息查询(公办、民办)",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "3岁以下幼儿托育服务机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "民办非学历培训机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "市民网上实名认证服务",
	"itemCode": "312090168000",
	"itemCodeNew": "531200025000001"
}, {
	"itemName": "副食品价格补贴发放银行卡维护",
	"itemCode": "312090133000",
	"itemCodeNew": "531200031100001"
}, {
	"itemName": "婚姻登记预约",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "城乡居民最低生活保障家庭证明出具",
	"itemCode": "312090023000",
	"itemCodeNew": "531200037900001"
}, {
	"itemName": "低收入困难家庭证明出具",
	"itemCode": "312090023000",
	"itemCodeNew": "531200037900001"
}, {
	"itemName": "定期定量生活补贴人员证明出具",
	"itemCode": "312090023000",
	"itemCodeNew": "531200037900001"
}, {
	"itemName": "特困人员证明出具",
	"itemCode": "312090023000",
	"itemCodeNew": "531200037900001"
}, {
	"itemName": "因病支出型贫困家庭证明出具",
	"itemCode": "312090023000",
	"itemCodeNew": "531200037900001"
}, {
	"itemName": "城乡居保缴费情况",
	"itemCode": "312090078000",
	"itemCodeNew": "531200029600001"
}, {
	"itemName": "上年度养老保险个人权益记录单",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "享受城乡居保养老金情况",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "业务审核办结情况",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "参加个人城镇基本养老保险缴费情况",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "个人享受城镇基本养老金情况",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "灵活就业人员电子对账单",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "上年度养老保险个人权益记录单",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "转往外省市缴费凭证",
	"itemCode": "312090078000",
	"itemCodeNew": ""
}, {
	"itemName": "居住证积分查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "社保卡个人信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "养老金卡折调整",
	"itemCode": "312090092000",
	"itemCodeNew": "531200049700001"
}, {
	"itemName": "失业保险金申领",
	"itemCode": "312090201000",
	"itemCodeNew": "531050021200102"
}, {
	"itemName": "本市户籍失业登记",
	"itemCode": "310750019000",
	"itemCodeNew": "531200061700001"
}, {
	"itemName": "本市户籍失业登记续登",
	"itemCode": "310750019000",
	"itemCodeNew": "531200061700001"
}, {
	"itemName": "来沪人员失业登记",
	"itemCode": "310750019000",
	"itemCodeNew": "531200061700001"
}, {
	"itemName": "劳动者个人基本信息查询及维护",
	"itemCode": "312090047000",
	"itemCodeNew": "531200038400001"
}, {
	"itemName": "本市户籍人员退出灵活就业登记",
	"itemCode": "312090045000",
	"itemCodeNew": "531200020200001"
}, {
	"itemName": "来沪人员灵活就业登记录入",
	"itemCode": "312090049000",
	"itemCodeNew": "531200020200001"
}, {
	"itemName": "本市户籍人员灵活就业登记",
	"itemCode": "312090045000",
	"itemCodeNew": "531200020200001"
}, {
	"itemName": "来沪人员灵活就业登记中止",
	"itemCode": "312090049000",
	"itemCodeNew": "531200020200001"
}, {
	"itemName": "申请大龄失业就业岗位补贴",
	"itemCode": "312090054000",
	"itemCodeNew": "531200053700001"
}, {
	"itemName": "申请“就业困难人员”灵活就业社会保险费补贴",
	"itemCode": "312090055000",
	"itemCodeNew": "531200024700001"
}, {
	"itemName": "餐饮脸谱",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "社会公用计量标准查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "法定计量检定机构考评员查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "计量标准考评员查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "二级注册计量师查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "企业名称状态查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "合同示范文本查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "广告发布登记查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "律师兼职执业变更专职执业",
	"itemCode": "310100284000-06",
	"itemCodeNew": ""
}, {
	"itemName": "律师执业机构变更",
	"itemCode": "310100284000-02",
	"itemCodeNew": ""
}, {
	"itemName": "律师执业证注销",
	"itemCode": "310100284000-04",
	"itemCodeNew": ""
}, {
	"itemName": "律师专职执业变更兼职执业",
	"itemCode": "310100284000-05",
	"itemCodeNew": ""
}, {
	"itemName": "首次申请律师兼职执业审核",
	"itemCode": "310100284000-03",
	"itemCodeNew": ""
}, {
	"itemName": "首次申请律师专职执业审核",
	"itemCode": "310100284000-01",
	"itemCodeNew": ""
}, {
	"itemName": "重新申请律师兼职执业审核",
	"itemCode": "310100284000-07",
	"itemCodeNew": ""
}, {
	"itemName": "重新申请律师专职执业审核",
	"itemCode": "310100284000-08",
	"itemCodeNew": ""
}, {
	"itemName": "办理结算服务项目的相关手续",
	"itemCode": "312090035000",
	"itemCodeNew": "531200033100001"
}, {
	"itemName": "办理门急诊就医记录册",
	"itemCode": "312090031000",
	"itemCodeNew": "531200037700001"
}, {
	"itemName": "办理居民医保受理登记",
	"itemCode": "312090036000",
	"itemCodeNew": "531200036100001"
}, {
	"itemName": "办理医保网站密码申请及变更",
	"itemCode": "312090032000",
	"itemCodeNew": "531200034900001"
}, {
	"itemName": "办理医疗卡书面挂失及撤销",
	"itemCode": "312090034000",
	"itemCodeNew": "531200032700001"
}, {
	"itemName": "本市开展异地就医的医院查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "商业保险机构网点信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "医保及相关服务机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "医保诊疗项目约定服务医院查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "长期护理机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "长期评估机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "参保人员待遇查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "年度累计医疗费用信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "医保就医明细查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "帐户清算信息查询",
	"itemCode": "",
	"itemCodeNew": "531200024600001"
}, {
	"itemName": "床位费医保支付标准",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "医保范围药品查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "医保个人信息",
	"itemCode": "312090040000",
	"itemCodeNew": "531200023700001"
}, {
	"itemName": "医疗费用分担模拟计算器",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "医疗机构查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "异地就医一件事",
	"itemCode": "31LB00004000",
	"itemCodeNew": "31LB00004000"
}, {
	"itemName": "医保综合减负试算",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "纯公积金贷款受理网点查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "个人住房公积金信息查询",
	"itemCode": "312090169000",
	"itemCodeNew": "531200022500001"
}, {
	"itemName": "公积金贷款试算",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "公积金还款计算",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "公积金缴存表查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "公积金缴存计算",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "公积金缴存提取经办银行查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "公积金区管理部查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "组合贷款各受理银行查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "上海市禁止、限制和控制危险化学品目录（第三批）查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "危险化学品生产企业安全生产许可证查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "危险化学品经营许可证核发查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "危险化学品建设项目信息查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "安全评价机构资质许可查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "安全生产检测检验机构资质认可查询",
	"itemCode": "",
	"itemCodeNew": ""
}, {
	"itemName": "安全生产协会会员培训机构条件核实情况查询",
	"itemCode": "",
	"itemCodeNew": ""
}];
/*
 * isCommunity  判断是否使用  itemCodeNew
 * isCommunity 为false代表自analytics/save.do 埋点
 * isCommunity 为true代表办件记录保存埋点 (recordUsingHistory)
 */
var returnCord = function(dataList, name,isCommunity) {
	if(Array.isArray(dataList)) {
		for(var i = 0; i < dataList.length; i++) {
			if(dataList[i].itemName == name) {
				if(isCommunity == false){
					return dataList[i].itemCode;
				}else if(isCommunity == true){
					return dataList[i].itemCodeNew;
				}
			}
		}
	}
};
var _vlstatId = _vlstatId || [];
// 添加事件
function trackEvent(eventName, childEventName) {
	childEventName = returnCord(dataEvent, eventName,false) || "";
	console.log(eventName + "----" + childEventName);
	_vlstatId.push(['urlCtl',
		'http://' + $.getConfigMsg.piwikurl + '/analytics/analytics/save.do'
	]);
	_vlstatId.push(['netFlag', eventName], ['netSubFlag', childEventName], ['ext1', '工作台']);
	(function() {
		var ma = document.createElement('script');
		ma.type = 'text/javascript';
		ma.async = true;
		ma.src = ('https:' == document.location.protocol ? 'https://' :
				'http://') +
			$.getConfigMsg.piwikurl + '/analytics/resources/vlstat/vlstat-min.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ma, s);
	})();
}
//wonders埋点 初始化
function wondersLogInit() {
	$.ajax({
		type: "get",
		url: $.getConfigMsg.preUrlSelfApi + "/infopub/deviceinfo/listMac.do", //http://10.81.16.56:8088
		dataType: "json",
		data: {
			stDeviceMac: $.config.get("uniqueId")
		},
		success: function(dataJson) {
			//wonders埋点
			if(typeof wondersLog != "undefined") {
				try {
					wondersLog.init('ywtb', {
						SPA: {
							//TODO: 是否是单页面应用
							is: true,
							//TODO: 若是单页面，则需要设置使用的技术手段hash or history
							mode: 'hash'
						},
						loaded: function(sdk) {
							//TODO: 设置自助机默认属性
							sdk.register_event_super_properties({
								$unique_code: dataJson.data[0].stDeviceMac,
								$address_code: dataJson.data[0].stDeviceCode,
								$address: dataJson.data[0].stDeviceAddress,
								$longitude: dataJson.data[0].nmLng,
								$latitude: dataJson.data[0].nmLat
							});
						}
					});
				} catch(e) {}
			}
		},
		error: function(err) {
			console.log(err);
		}
	});
}
wondersLogInit();

//查询类
function trackEventForQuery(eventName, itemCode, itemName, deptName, name, idCard, mobile) {
	if(typeof wondersLog != "undefined") {
		try {
			wondersLog.track_event('SSM_QUERY', {
				$event_name: eventName, // 事项名称
				$item_code: itemCode, // 办理项代码
				$item_name: itemName, // 办理项名称
				$dept_name: deptName, // 受理部门名称
				$user_type: idCard == "" ? "" : 1, // 用户类型
				$project_target: name, // 办件对象
				$license_no: idCard, // 证件号
				$mobile: mobile || "" // 办理人手机号
			});
		} catch(e) {}
	}
}

//办理类
function trackEventForAffairs(itemCode, itemName, deptName, name, idCard, mobile) {
	if(typeof wondersLog != "undefined") {
		try {
			wondersLog.track_event('SSM_AFFAIRS', {
				$item_code: itemCode, // 办理项代码
				$item_name: itemName, // 办理项名称
				$dept_name: deptName, // 受理部门名称
				$user_type: idCard == "" ? "" : 1, // 用户类型
				$project_target: name, // 办件对象
				$license_no: idCard, // 证件号
				$mobile: mobile || "" // 办理人手机号
			});
		} catch(e) {}
	}
}

//预约类
function trackEventForOrder(eventName) {
	if(typeof wondersLog != "undefined") {
		wondersLog.track_event('SSM_ORDER', {
			$item_code: 'SH00SH123456', // 事项代码
			$item_name: eventName, // 事项名称
			$dept_name: '浦东新区派出所', // 受理部门名称
			$user_type: 1, // 用户类型
			$project_target: '张三', // 办件对象
			$license_no: '3101112020112121234', // 证件号
			$mobile: '18888888888', //办理人手机号
			$order_start_time: '2020-01-01 08:00:00', // 预约时段开始
			$order_end_time: '2020-01-01 17:00:00', // 预约时段结束
		});
	}
}

/*
 * 2、办事提交/查询结果保存
 */
function saveApplyResult(id, content) {
	$.ajax({
		type: "get",
		url: $.getConfigMsg.preUrl + "/aci/workPlatform/saveApplyResult.do",
		dataType: "jsonp",
		jsonp: "jsonpCallback",
		data: {
			linkId: id,
			content: content,
		},
		success: function(dataJson) {
			console.log(dataJson);
		},
		error: function(err) {
			console.log("workPlatform/saveApplyResult.do err");
		}
	});
}
/*
 *3、附件上传
 */
function uploadStuff() {
	$.ajax({
		type: "get",
		url: $.getConfigMsg.preUrl + "/aci/workPlatform/uploadStuff.do",
		dataType: "jsonp",
		jsonp: "jsonpCallback",
		data: {
			file: "",
			linkId: "",
		},
		success: function(dataJson) {
			callback && callback(dataJson);
		},
		error: function(err) {
			console.log("workPlatform/uploadStuff.do err");
		}
	});
}

/**
 * 工作台使用模块记录接口 
 * 1、模块使用记录保存
 */
function recordUsingHistory(modelName, modelOp, itemName, name, idCard, mobile, businessNo, content) {
	let itemNo = returnCord(dataEvent, itemName,true) || "";
	$.ajax({
		type: "post",
		url: $.getConfigMsg.preUrl+"/aci/workPlatform/recordUsingHistory.do",
		dataType: "json",
		contentType: 'application/x-www-form-urlencoded',
//		jsonp:'jsonpCallback',
		beforeSend: function(xhr) {
            xhr.setRequestHeader("account",'admin');
        },
		data: {
			ST_QUERY_HIS_ID: "",
			ST_MACHINE_ID: $.config.get("uniqueId") || '',
			ST_MODULE_NAME: modelName,
			ST_MODULE_OP: modelOp,
			ST_ITEM_NAME: itemName,
			ST_NAME: name,
			ST_IDENTITY_NO: idCard,
			ST_MOBILE: mobile,
			ST_BUSINESS_NO: businessNo,
			ST_DESC: "",
			ST_OP_RESULT: 'SUCCESS',
			DT_CREATE: new Date(),
			ST_EXT1: "",
			ST_EXT2: "",
			ST_EXT3: "",
			ST_EXT4: "",
			ST_ITEM_NO:itemNo,
		},
		success: function(dataJson) {
			saveApplyResult(dataJson.HISTORYID, content);
		},
		error: function(err) {
			console.log("workPlatform/recordUsingHistory.do err");
		}
	});
}